# üóÑÔ∏è –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö MongoDB

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è **–ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** –∏–∑ –ø–∞–ø–∫–∏ `dataBase`.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
server/
‚îú‚îÄ‚îÄ dataBase/          # –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö MongoDB
‚îÇ   ‚îú‚îÄ‚îÄ *.wt           # –§–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö WiredTiger
‚îÇ   ‚îú‚îÄ‚îÄ journal/       # –ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ docker-compose.yml # MongoDB –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–Ω—Ç–∏—Ä—É–µ—Ç ./dataBase
‚îî‚îÄ‚îÄ ...
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
```
mongodb://mongodb:27017/lex-ai  # –ò–∑–Ω—É—Ç—Ä–∏ Docker
mongodb://localhost:27017/lex-ai # –°–Ω–∞—Ä—É–∂–∏ Docker
```

**–ë–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏!** - –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞–ø—Ä—è–º—É—é.

---

## üöÄ –ó–∞–ø—É—Å–∫

### –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫:
```bash
cd server/
./deploy-local.sh
```

### –ò–ª–∏ —á–µ—Ä–µ–∑ Make:
```bash
make dev
```

### –í—Ä—É—á–Ω—É—é:
```bash
docker-compose up -d --build
```

---

## üìä –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB shell:
```bash
# –ò–∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
make db-shell

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
docker-compose exec mongodb mongosh lex-ai

# –°–Ω–∞—Ä—É–∂–∏ Docker (–µ—Å–ª–∏ mongosh —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ)
mongosh mongodb://localhost:27017/lex-ai
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ mongosh:
```javascript
// –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏–∏
show collections

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
db.users.find().pretty()
db.users.countDocuments()

// –ß–∞—Ç—ã
db.chats.find().limit(5)
db.messages.countDocuments()

// –î–æ–∫—É–º–µ–Ω—Ç—ã
db.documents.find().pretty()

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
db.stats()
```

---

## üíæ Backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ backup:
```bash
make backup
# –°–æ–∑–¥–∞—Å—Ç backup –≤ –ø–∞–ø–∫–µ ./backups/backup-YYYYMMDD-HHMMSS/
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
```bash
make restore BACKUP_DIR=./backups/backup-20241225-150000
```

### –†—É—á–Ω–æ–π backup:
```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–π –ø–∞–ø–∫–∏ dataBase
cp -r dataBase dataBase_backup_$(date +%Y%m%d_%H%M%S)

# –ß–µ—Ä–µ–∑ mongodump
docker-compose exec mongodb mongodump --db=lex-ai --out=/tmp/backup
docker cp lex-mongodb:/tmp/backup ./manual_backup/
```

---

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
```bash
docker-compose ps
```

### –õ–æ–≥–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```bash
docker-compose logs mongodb
docker-compose logs -f mongodb  # –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```bash
docker-compose restart mongodb
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ–≥–æ:
```bash
docker-compose down
```

### –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–û–°–¢–û–†–û–ñ–ù–û!):
```bash
docker-compose down -v  # –£–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!
```

---

## üìÇ –õ–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º

### –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º:
```bash
# –ü—É—Ç—å –∫ –¥–∞–Ω–Ω—ã–º
ls -la ./dataBase/

# –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
du -sh ./dataBase/

# –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
ls -la dataBase/
```

### Backup —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã:
```bash
# –ü—Ä–æ—Å—Ç–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
tar -czf database_backup_$(date +%Y%m%d).tar.gz dataBase/

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
tar -xzf database_backup_20241225.tar.gz
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã:
- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- –ü—Ä–æ—Å—Ç–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏

### ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
- –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
- –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ backup –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –†–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ backup (`make backup`)
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–∞–∑–º–µ—Ä–æ–º –ø–∞–ø–∫–∏ `dataBase/`
- –ù–µ —É–¥–∞–ª—è–π—Ç–µ —Ñ–∞–π–ª—ã –∏–∑ `dataBase/` –≤—Ä—É—á–Ω—É—é
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º –ø—Ä–æ–µ–∫—Ç–∞

---

## üéØ –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫
make dev

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
make db-shell

# Backup
make backup

# –õ–æ–≥–∏
make logs

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
make stop

# –û—á–∏—Å—Ç–∫–∞
make clean
```

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ! üéâ** 